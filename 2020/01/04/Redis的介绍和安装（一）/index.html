<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Redis的介绍和安装（一） | Linsan 的个人博客</title><meta name="description" content="Redis的介绍和安装（一）"><meta name="keywords" content="Redis"><meta name="author" content="Linsan"><meta name="copyright" content="Linsan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Redis的介绍和安装（一）"><meta name="twitter:description" content="Redis的介绍和安装（一）"><meta name="twitter:image" content="http://linsan925.github.io/images/redis1.png"><meta property="og:type" content="article"><meta property="og:title" content="Redis的介绍和安装（一）"><meta property="og:url" content="http://linsan925.github.io/2020/01/04/Redis%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/"><meta property="og:site_name" content="Linsan 的个人博客"><meta property="og:description" content="Redis的介绍和安装（一）"><meta property="og:image" content="http://linsan925.github.io/images/redis1.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://linsan925.github.io/2020/01/04/Redis%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/"><link rel="prev" title="Redis的基本配置（二）" href="http://linsan925.github.io/2020/01/04/Redis%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%88%E4%BA%8C%EF%BC%89/"><link rel="next" title="NoSQL的基本概义" href="http://linsan925.github.io/2020/01/04/NoSQL%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Linsan 的个人博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar1.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">63</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">79</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">26</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-Redis简介"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">1.Redis简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-Redis的性能"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">2.Redis的性能</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-安装Redis"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">3.安装Redis</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-redis数据结构"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">4.redis数据结构</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-redis数据存储"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">5.redis数据存储</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-redis主从配置"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">6.redis主从配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-redis起步-链接整理"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">7.redis起步(链接整理)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Redis是什么"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">Redis是什么</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Redis不可能比Memcache快"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">Redis不可能比Memcache快</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#单台Redis的存放数据必须比物理内存小"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">单台Redis的存放数据必须比物理内存小</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Redis的VM实现是重复造轮子"><span class="toc_mobile_items-number">7.4.</span> <span class="toc_mobile_items-text">Redis的VM实现是重复造轮子</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#用get-set方式使用Redis"><span class="toc_mobile_items-number">7.5.</span> <span class="toc_mobile_items-text">用get&#x2F;set方式使用Redis</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#使用aof代替snapshot"><span class="toc_mobile_items-number">7.6.</span> <span class="toc_mobile_items-text">使用aof代替snapshot</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#小结"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">小结</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis简介"><span class="toc-number">1.</span> <span class="toc-text">1.Redis简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Redis的性能"><span class="toc-number">2.</span> <span class="toc-text">2.Redis的性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-安装Redis"><span class="toc-number">3.</span> <span class="toc-text">3.安装Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-redis数据结构"><span class="toc-number">4.</span> <span class="toc-text">4.redis数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-redis数据存储"><span class="toc-number">5.</span> <span class="toc-text">5.redis数据存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-redis主从配置"><span class="toc-number">6.</span> <span class="toc-text">6.redis主从配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-redis起步-链接整理"><span class="toc-number">7.</span> <span class="toc-text">7.redis起步(链接整理)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis是什么"><span class="toc-number">7.1.</span> <span class="toc-text">Redis是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis不可能比Memcache快"><span class="toc-number">7.2.</span> <span class="toc-text">Redis不可能比Memcache快</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单台Redis的存放数据必须比物理内存小"><span class="toc-number">7.3.</span> <span class="toc-text">单台Redis的存放数据必须比物理内存小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis的VM实现是重复造轮子"><span class="toc-number">7.4.</span> <span class="toc-text">Redis的VM实现是重复造轮子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用get-set方式使用Redis"><span class="toc-number">7.5.</span> <span class="toc-text">用get&#x2F;set方式使用Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用aof代替snapshot"><span class="toc-number">7.6.</span> <span class="toc-text">使用aof代替snapshot</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">8.</span> <span class="toc-text">小结</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/images/top_img3.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Redis的介绍和安装（一）</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-01-04<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-22</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Redis/">Redis</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/01/04/Redis%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="1-Redis简介"><a href="#1-Redis简介" class="headerlink" title="1.Redis简介"></a><strong>1.Redis简介</strong></h2><p><a href="http://code.google.com/p/redis/" target="_blank" rel="noopener">Redis</a>是一个key-value存储系统。和Memcached类似，但是解决了断电后数据完全丢失的情况，而且她支持更多无化的value类型，除了和string外，还支持lists（链表）、sets（集合）和zsets（有序集合）几种数据类型。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。</p>
<h2 id="2-Redis的性能"><a href="#2-Redis的性能" class="headerlink" title="2.Redis的性能"></a><strong>2.Redis的性能</strong></h2><p>下面是官方的bench-mark数据：</p>
<p>The test was done with 50 simultaneous clients performing 100000 requests.</p>
<p>The value SET and GET is a 256 bytes string.</p>
<p>The Linux box is running <strong>Linux 2.6</strong>, it’s <strong>Xeon X3320 2.5Ghz</strong>.</p>
<p>Text executed using the loopback interface (127.0.0.1).</p>
<p>Results: <strong>about 110000 SETs per second, about 81000 GETs per second.</strong></p>
<p>更多详细数据请见官方bench-mark page（<a href="http://code.google.com/p/redis/wiki/Benchmarks" target="_blank" rel="noopener">http://code.google.com/p/redis/wiki/Benchmarks</a>）</p>
<h2 id="3-安装Redis"><a href="#3-安装Redis" class="headerlink" title="3.安装Redis"></a><strong>3.安装Redis</strong></h2><p>Redis的代码遵循ANSI-C编写，可以在所有POSIX系统（如Linux, *BSD, Mac OS X, Solaris等）上安装运行。而且Redis并不依赖任何非标准库，也没有编译参数必需添加。redis的安装出奇的简单，这可能也是他风靡的一个原因，让人很容易上手，不像某些东西，编译阶段就能让人完全绝望。</p>
<p>先去官网下载源码：</p>
<p>wget <a href="http://redis.googlecode.com/files/redis-2.4.6.tar.gz" target="_blank" rel="noopener">http://redis.googlecode.com/files/redis-2.4.6.tar.gz</a></p>
<p>解压：</p>
<p>tar –zxvf redis-2.4.6.tar.gz</p>
<p>编译</p>
<p>需要说明的事，redis的安装非常简单，已经有现成的Makefile文件，直接运行make命令即可。</p>
<p>make</p>
<p>make install</p>
<p>Redis 由四个可执行文件：<strong>redis-benchmark</strong>、<strong>redis-cli</strong>、<strong>redis-server</strong>、<strong>redis-stat</strong> 这四个文件，加上一个<strong>redis.conf</strong>就构成了整个redis的最终可用包。它们的作用如下：</p>
<p>redis-server：Redis服务器的daemon启动程序</p>
<p>redis-cli：Redis命令行操作工具。当然，你也可以用telnet根据其纯文本协议来操作</p>
<p>redis-benchmark：Redis性能测试工具，测试Redis在你的系统及你的配置下的读写性能</p>
<p>redis-stat：Redis状态检测工具，可以检测Redis当前状态参数及延迟状况</p>
<p>现在就可以启动redis了，redis只有一个启动参数，就是他的配置文件路径。</p>
<p>redis-server /etc/redis.conf</p>
<p>注意，默认复制过去的<strong>redis.conf</strong>文件的<strong>daemonize</strong>参数为<strong>no</strong>，所以redis不会在后台运行，这时要测试，我们需要重新开一个终端。修改为<strong>yes</strong>则为后台运行redis。另外配置文件中规定了pid文件，log文件和数据文件的地址，如果有需要先修改，默认log信息定向到stdout.</p>
<p>下面是redis.conf的主要配置参数的意义：</p>
<p>daemonize：是否以后台daemon方式运行</p>
<p>pidfile：pid文件位置</p>
<p>port：监听的端口号</p>
<p>timeout：请求超时时间</p>
<p>loglevel：log信息级别</p>
<p>logfile：log文件位置</p>
<p>databases：开启数据库的数量</p>
<p>save * <em>：保存快照的频率，第一个</em>表示多长时间，第三个*表示执行多少次写操作。在一定时间内执行一定数量的写操作时，自动保存快照。可设置多个条件。</p>
<p>rdbcompression：是否使用压缩</p>
<p>dbfilename：数据快照文件名（只是文件名，不包括目录）</p>
<p>dir：数据快照的保存目录（这个是目录）</p>
<p>appendonly：是否开启appendonlylog，开启的话每次写操作会记一条log，这会提高数据抗风险能力，但影响效率。</p>
<p>appendfsync：appendonlylog如何同步到磁盘（三个选项，分别是每次写都强制调用fsync、每秒启用一次fsync、不调用fsync等待系统自己同步）</p>
<p>这时你可以打开一个终端进行测试了，配置文件中默认的监听端口是<strong>6379</strong></p>
<p>我们可以开启一个Redis客户端进行测试</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">\[root@SNDA-192-168-1-114 ~\]# redis-cli   </span><br><span class="line">Could not connect to Redis at 127.0.0.1:6379: Connection refused   </span><br><span class="line">not connected&gt; exit   </span><br><span class="line">\[root@SNDA-192-168-1-114 ~\]# redis-server &#x2F;etc&#x2F;redis.conf   </span><br><span class="line">\[root@SNDA-192-168-1-114 ~\]# redis-cli   </span><br><span class="line">redis 127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure></div>

<h2 id="4-redis数据结构"><a href="#4-redis数据结构" class="headerlink" title="4.redis数据结构"></a><strong>4.redis数据结构</strong></h2><p>redis 的作者antirez曾称其为一个数据结构服务器（<strong>data structures server</strong>），这是一个非常准确的表述，redis的所有功能就是将数据以其固有的几种结构保存，并提供给用户操作这几种结构的接口。我们可以想象我们在各种语言中的那些固有数据类型及其操作。</p>
<p>redis目前提供四种数据类型：<strong>string</strong>,<strong>list</strong>,<strong>set</strong>及<strong>zset</strong>(sorted set)和<strong>Hash</strong>。</p>
<p><strong>string</strong>是最简单的类型，你可以理解成与Memcached一模一个的类型，一个key对应一个value，其上支持的操作与Memcached的操作类似。但它的功能更丰富。</p>
<p><strong>list</strong>是一个链表结构，主要功能是push、pop、获取一个范围的所有值等等。操作中key理解为链表的名字。</p>
<p><strong>set</strong>是集合，和我们数学中的集合概念相似，对集合的操作有添加删除元素，有对多个集合求交并差等操作。操作中key理解为集合的名字。</p>
<p><strong>zset</strong>是set的一个升级版本，他在set的基础上增加了一个顺序属性，这一属性在添加修改元素的时候可以指定，每次指定后，zset会自动重新按新的值调整顺序。可以理解了有两列的mysql表，一列存value，一列存顺序。操作中key理解为zset的名字。</p>
<p><strong>Hash</strong>数据类型允许用户用Redis存储对象类型,Hash数据类型的一个重要优点是,当你存储的数据对象只有很少几个key值时,数据存储的内存消耗会很小.更多关于Hash数据类型的说明请见: <a href="http://code.google.com/p/redis/wiki/Hashes" target="_blank" rel="noopener">http://code.google.com/p/redis/wiki/Hashes</a></p>
<p>在官网上给出了所有支持的接口列表，并副副附有详细的介绍，地址：</p>
<p><a href="http://code.google.com/p/redis/wiki/CommandReference" target="_blank" rel="noopener">http://code.google.com/p/redis/wiki/CommandReference</a></p>
<p>另外，作者还提供了一个非常贴心的web命令行模拟页面，供初学者试用redis，地址：</p>
<p><a href="http://try.redis-db.com/" target="_blank" rel="noopener">http://try.redis-db.com/</a></p>
<h2 id="5-redis数据存储"><a href="#5-redis数据存储" class="headerlink" title="5.redis数据存储"></a><strong>5.redis数据存储</strong></h2><p>redis的存储分为内存存储、磁盘存储和log文件三部分，配置文件中有三个参数对其进行配置。</p>
<p><strong>save seconds updates</strong>，<strong>save</strong>配置，指出在多长时间内，有多少次更新操作，就将数据同步到数据文件。这个可以多个条件配合，比如默认配置文件中的设置，就设置了三个条件。</p>
<p><strong>appendonly yes</strong>/<strong>no</strong> ，<strong>appendonly</strong>配置，指出是否在每次更新操作后进行日志记录，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为redis本身同步数据文件是按上面的save条件来同步的，所以有的数据会在一段时间内只存在于内存中。</p>
<p><strong>appendfsync no</strong>/<strong>always</strong>/<strong>everysec</strong> ，<strong>appendfsync</strong>配置，<strong>no</strong>表示等操作系统进行数据缓存同步到磁盘，<strong>always</strong>表示每次更新操作后手动调用<strong>fsync</strong>()将数据写到磁盘，<strong>everysec</strong>表示每秒同步一次。</p>
<h2 id="6-redis主从配置"><a href="#6-redis主从配置" class="headerlink" title="6.redis主从配置"></a><strong>6.redis主从配置</strong></h2><p>redis支持<strong>master-slave</strong>的主从配置，配置方法是在从机的配置文件中指定<strong>slaveof</strong>参数为主机的ip和port即可</p>
<h2 id="7-redis起步-链接整理"><a href="#7-redis起步-链接整理" class="headerlink" title="7.redis起步(链接整理)"></a><strong>7.redis起步(链接整理)</strong></h2><p>项目首页，下方是各种语言支持列表：</p>
<p><a href="http://code.google.com/p/redis/" target="_blank" rel="noopener">http://code.google.com/p/redis/</a></p>
<p>作者在wiki中给出了一个非常好的例子，以使我们可以快速上手，地址：</p>
<p><a href="http://code.google.com/p/redis/wiki/TwitterAlikeExample" target="_blank" rel="noopener">http://code.google.com/p/redis/wiki/TwitterAlikeExample</a></p>
<p>同时作者推荐的另一个教程，地址：</p>
<p><a href="http://labs.alcacoop.it/doku.php?id=articles:redis_land" target="_blank" rel="noopener">http://labs.alcacoop.it/doku.php?id=articles:redis_land</a></p>
<p>一个redis爱好者创建的相关问题讨论网站：</p>
<p><a href="http://www.rediscookbook.org/" target="_blank" rel="noopener">http://www.rediscookbook.org/</a></p>
<p>为什么使用 Redis及其产品定位</p>
<p><a href="http://www.infoq.com/cn/articles/tq-why-choose-redis" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/tq-why-choose-redis</a></p>
<p>Redis内存使用优化与存储</p>
<p><a href="http://www.infoq.com/cn/articles/tq-redis-memory-usage-optimization-storage" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/tq-redis-memory-usage-optimization-storage</a></p>
<p>前几天微博发生了一起大的系统故障，很多技术的朋友都比较关心，其中的原因不会超出James Hamilton在On Designing and Deploying Internet-Scale Service(1)概括的那几个范围，James第一条经验“Design for failure”是所有互联网架构成功的一个关键。互联网系统的工程理论其实非常简单，James paper中内容几乎称不上理论，而是多条实践经验分享，每个公司对这些经验的理解及执行力决定了架构成败。</p>
<p>题外话说完，最近又研究了Redis。去年曾做过一个MemcacheDB, Tokyo Tyrant, Redis performance test，到目前为止，这个benchmark结果依然有效。这1年我们经历了很多眼花缭乱的key value存储产品的诱惑，从Cassandra的淡出(Twitter暂停在主业务使用)到HBase的兴起(Facebook新的邮箱业务选用HBase(2))，当再回头再去看Redis，发现这个只有1万多行源代码的程序充满了神奇及大量未经挖掘的特性。Redis性能惊人，国内前十大网站的子产品估计用1台Redis就可以满足存储及Cache的需求。除了性能印象之外，业界其实普遍对Redis的认识存在一定误区。本文提出一些观点供大家探讨。</p>
<h3 id="Redis是什么"><a href="#Redis是什么" class="headerlink" title="Redis是什么"></a>Redis是什么</h3><p>这个问题的结果影响了我们怎么用Redis。如果你认为Redis是一个key value store, 那可能会用它来代替MySQL；如果认为它是一个可以持久化的cache, 可能只是它保存一些频繁访问的临时数据。Redis是REmote DIctionary Server的缩写，在Redis在官方网站的的副标题是A persistent key-value database with built-in net interface written in ANSI-C for Posix systems，这个定义偏向key value store。还有一些看法则认为Redis是一个memory database，因为它的高性能都是基于内存操作的基础。另外一些人则认为Redis是一个data structure server，因为Redis支持复杂的数据特性，比如List, Set等。对Redis的作用的不同解读决定了你对Redis的使用方式。</p>
<p>互联网数据目前基本使用两种方式来存储，关系数据库或者key value。但是这些互联网业务本身并不属于这两种数据类型，比如用户在社会化平台中的关系，它是一个list，如果要用关系数据库存储就需要转换成一种多行记录的形式，这种形式存在很多冗余数据，每一行需要存储一些重复信息。如果用key value存储则修改和删除比较麻烦，需要将全部数据读出再写入。Redis在内存中设计了各种数据类型，让业务能够高速原子的访问这些数据结构，并且不需要关心持久存储的问题，从架构上解决了前面两种存储需要走一些弯路的问题。</p>
<h3 id="Redis不可能比Memcache快"><a href="#Redis不可能比Memcache快" class="headerlink" title="Redis不可能比Memcache快"></a>Redis不可能比Memcache快</h3><p>很多开发者都认为Redis不可能比Memcached快，Memcached完全基于内存，而Redis具有持久化保存特性，即使是异步的，Redis也不可能比Memcached快。但是测试结果基本是Redis占绝对优势。一直在思考这个原因，目前想到的原因有这几方面。</p>
<p>Libevent。和Memcached不同，Redis并没有选择libevent。Libevent为了迎合通用性造成代码庞大(目前Redis代码还不到libevent的1/3)及牺牲了在特定平台的不少性能。Redis用libevent中两个文件修改实现了自己的epoll event loop(4)。业界不少开发者也建议Redis使用另外一个libevent高性能替代libev，但是作者还是坚持Redis应该小巧并去依赖的思路。一个印象深刻的细节是编译Redis之前并不需要执行./configure。</p>
<p>CAS问题。CAS是Memcached中比较方便的一种防止竞争修改资源的方法。CAS实现需要为每个cache key设置一个隐藏的cas token，cas相当value版本号，每次set会token需要递增，因此带来CPU和内存的双重开销，虽然这些开销很小，但是到单机10G+ cache以及QPS上万之后这些开销就会给双方相对带来一些细微性能差别(5)。</p>
<h3 id="单台Redis的存放数据必须比物理内存小"><a href="#单台Redis的存放数据必须比物理内存小" class="headerlink" title="单台Redis的存放数据必须比物理内存小"></a>单台Redis的存放数据必须比物理内存小</h3><p>Redis的数据全部放在内存带来了高速的性能，但是也带来一些不合理之处。比如一个中型网站有100万注册用户，如果这些资料要用Redis来存储，内存的容量必须能够容纳这100万用户。但是业务实际情况是100万用户只有5万活跃用户，1周来访问过1次的也只有15万用户，因此全部100万用户的数据都放在内存有不合理之处，RAM需要为冷数据买单。</p>
<p>这跟操作系统非常相似，操作系统所有应用访问的数据都在内存，但是如果物理内存容纳不下新的数据，操作系统会智能将部分长期没有访问的数据交换到磁盘，为新的应用留出空间。现代操作系统给应用提供的并不是物理内存，而是虚拟内存(Virtual Memory)的概念。</p>
<p>基于相同的考虑，Redis 2.0也增加了VM特性。让Redis数据容量突破了物理内存的限制。并实现了数据冷热分离。</p>
<h3 id="Redis的VM实现是重复造轮子"><a href="#Redis的VM实现是重复造轮子" class="headerlink" title="Redis的VM实现是重复造轮子"></a>Redis的VM实现是重复造轮子</h3><p>Redis的VM依照之前的epoll实现思路依旧是自己实现。但是在前面操作系统的介绍提到OS也可以自动帮程序实现冷热数据分离，Redis只需要OS申请一块大内存，OS会自动将热数据放入物理内存，冷数据交换到硬盘，另外一个知名的“理解了现代操作系统(3)”的Varnish就是这样实现，也取得了非常成功的效果。</p>
<p>作者antirez在解释为什么要自己实现VM中提到几个原因(6)。主要OS的VM换入换出是基于Page概念，比如OS VM1个Page是4K, 4K中只要还有一个元素即使只有1个字节被访问，这个页也不会被SWAP, 换入也同样道理，读到一个字节可能会换入4K无用的内存。而Redis自己实现则可以达到控制换入的粒度。另外访问操作系统SWAP内存区域时block进程，也是导致Redis要自己实现VM原因之一。</p>
<h3 id="用get-set方式使用Redis"><a href="#用get-set方式使用Redis" class="headerlink" title="用get/set方式使用Redis"></a>用get/set方式使用Redis</h3><p>作为一个key value存在，很多开发者自然的使用set/get方式来使用Redis，实际上这并不是最优化的使用方法。尤其在未启用VM情况下，Redis全部数据需要放入内存，节约内存尤其重要。</p>
<p>假如一个key-value单元需要最小占用512字节，即使只存一个字节也占了512字节。这时候就有一个设计模式，可以把key复用，几个key-value放入一个key中，value再作为一个set存入，这样同样512字节就会存放10-100倍的容量。</p>
<p>这就是为了节约内存，建议使用hashset而不是set/get的方式来使用Redis，详细方法见参考文献(7)。</p>
<h3 id="使用aof代替snapshot"><a href="#使用aof代替snapshot" class="headerlink" title="使用aof代替snapshot"></a>使用aof代替snapshot</h3><p>Redis有两种存储方式，默认是snapshot方式，实现方法是定时将内存的快照(snapshot)持久化到硬盘，这种方法缺点是持久化之后如果出现crash则会丢失一段数据。因此在完美主义者的推动下作者增加了aof方式。aof即append only mode，在写入内存数据的同时将操作命令保存到日志文件，在一个并发更改上万的系统中，命令日志是一个非常庞大的数据，管理维护成本非常高，恢复重建时间会非常长，这样导致失去aof高可用性本意。另外更重要的是Redis是一个内存数据结构模型，所有的优势都是建立在对内存复杂数据结构高效的原子操作上，这样就看出aof是一个非常不协调的部分。</p>
<p>其实aof目的主要是数据可靠性及高可用性，在Redis中有另外一种方法来达到目的：Replication。由于Redis的高性能，复制基本没有延迟。这样达到了防止单点故障及实现了高可用。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>要想成功使用一种产品，我们需要深入了解它的特性。Redis性能突出，如果能够熟练的驾驭，对国内很多大型应用具有很大帮助。希望更多同行加入到Redis使用及代码研究行列。</p>
<blockquote>
<p><a href="http://www.linuxidc.com/Linux/2011-02/32700.htm" target="_blank" rel="noopener">http://www.linuxidc.com/Linux/2011-02/32700.htm</a></p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Linsan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://linsan925.github.io/2020/01/04/Redis%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/">http://linsan925.github.io/2020/01/04/Redis%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://linsan925.github.io">Linsan 的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis    </a></div><div class="post_share"><div class="social-share" data-image="/images/redis1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/01/04/Redis%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%88%E4%BA%8C%EF%BC%89/"><img class="prev_cover lazyload" data-src="/images/redis1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Redis的基本配置（二）</span></div></a></div><div class="next-post pull_right"><a href="/2020/01/04/NoSQL%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"><img class="next_cover lazyload" data-src="/images/adf4asd424fsddaf42dsafds.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>NoSQL的基本概义</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/01/16/MongoDB与Redis的区别/" title="MongoDB与Redis的区别"><img class="relatedPosts_cover lazyload"data-src="/images/5cf8b7015876e423.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-16</div><div class="relatedPosts_title">MongoDB与Redis的区别</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/04/Redis的三种集群策略（三）/" title="详解三种集群策略（三）"><img class="relatedPosts_cover lazyload"data-src="/images/redis1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-04</div><div class="relatedPosts_title">详解三种集群策略（三）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/04/Redis的基本配置（二）/" title="Redis的基本配置（二）"><img class="relatedPosts_cover lazyload"data-src="/images/redis1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-04</div><div class="relatedPosts_title">Redis的基本配置（二）</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '18a9cca10b447bbb497c',
  clientSecret: '8b9beafffd3c06626360f144921cfdb17847aece',
  repo: 'linsan925.github.io',
  owner: 'linsan925',
  admin: 'linsan925',
  id: md5(decodeURI(location.pathname)),
  language: 'en',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" style="background-image: url(/images/top_img3.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Linsan</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>